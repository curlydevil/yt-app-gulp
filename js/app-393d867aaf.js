!function(){"use strict";angular.module("common.services",["angular-google-gapi","ngResource"])}(),function(){"use strict";function t(t,e,i){function l(){return e.login().then(c)}function s(){return i.getUser()}function n(){return i.isLogin()}function o(){return e.checkAuth()}function a(){var l=e.getToken().$$state.value.access_token;return i.isLogin(!1),t.jsonp(u.replace("{token}",l),{headers:{"content-type":"application/json",Accept:"application/json"}})}function c(){var i=e.getToken().$$state.value.access_token;t.defaults.headers.common.Authorization="Bearer "+i}var r="277572490754-mv9uu31naka02tfef9cv7kv6ntfqvioa.apps.googleusercontent.com",d="https://www.googleapis.com/auth/youtube",u="https://accounts.google.com/o/oauth2/revoke?token={token}";return e.setClient(r),e.setScope(d),{login:l,getUser:s,isLoggedIn:n,checkAuth:o,logOut:a,setAuthToken:c}}angular.module("common.services").factory("authorizationService",["$http","GAuth","GData",t])}(),function(){function t(t,e,i){function l(t){null===t?f.selectPlaylistitem(null):t.items.length||v(t),P=t,i.publish("playlist.selected",t)}function s(t){null===t||t.src||(t.src="https://www.youtube.com/embed/"+t.snippet.resourceId.videoId+"?list="+t.snippet.playlistId),b=t,i.publish("playlistitem.selected")}function n(){return t.query(function(t){f.playlists=t.items;for(var e=0;e<f.playlists.length;e++)f.playlists[e].items=[];f.playlists.length&&f.selectPlaylist(f.playlists[0]),i.publish("playlists.loaded",f.playlists)}).$promise}function o(e){var l=new t({snippet:e.snippet});return t.save(l).$promise.then(function(t){t.items=[],f.playlists.splice(0,0,t),i.publish("playlist.added",t)},function(t){humane.log("Error adding playlist"),console.log(t)})}function a(e){if(confirm("Are you sure you want to remove playlist?")){var l=new t({id:e.id});return t["delete"](l).$promise.then(function(t){var l=_.indexOf(f.playlists,e);-1!==l&&f.playlists.splice(l,1),e===P&&g(l),i.publish("playlist.removed",e)},function(t){humane.log("Error deleting playlist"),console.log(t)})}}function c(e){var l=new t({id:e.id,snippet:e.snippet});return t.update(l,function(t){i.publish("playlist.updated",t)},function(t){humane.log("Error updating playlist"),console.log(t)}).$promise}function r(t,l){var s=new e({snippet:{playlistId:t.id,resourceId:{kind:"youtube#video",videoId:l}}});return e.save(s,function(e){var l=_.indexOf(f.playlists,t);-1!==l&&f.playlists[l].items.splice(0,0,e),i.publish("playlistitem.added",e)},function(t){humane.log("Error adding item to playlist"),console.log(t)}).$promise}function d(t,l){var s=new e({id:l.id});return e["delete"](s,function(e){var n=_.indexOf(f.playlists,t);if(-1!==n){var o=_.findIndex(f.playlists[n].items,function(t){return t.id===s.id});-1!==o&&f.playlists[n].items.splice(o,1)}i.publish("playlistitem.removed",{playlist:t,item:l})},function(t){humane.log("Error removing item from playlist"),console.log(t)}).$promise}function u(t){return e.query({playlistId:t.id},function(e){var l=h(t);f.playlists[l].items=e.items,i.publish("playlist.filled",t)},function(t){humane.log("Error filling the playlist"),console.log(t)}).$promise}function p(t,e){return _.any(t.items,function(t){return t.snippet.resourceId.videoId===e})}function y(){return b}function m(){return P}function v(t){f.fillPlaylist(t).then(function(){t.items.length&&f.selectPlaylistitem(t.items[0])})}function g(t){for(;!f.playlists[t]&&t>=0;)t--;f.selectPlaylist(t>=0?f.playlists[t]:null)}function h(t){return _.findIndex(f.playlists,function(e){return e.id===t.id})}var f=this,b=null,P=null;f.playlists=[],f.playlistsPromise=n(),f.selectPlaylist=l,f.selectPlaylistitem=s,f.selectedPlaylistitem=y,f.selectedPlaylist=m,f.addPlaylist=o,f.removePlaylist=a,f.updatePlaylist=c,f.fillPlaylist=u,f.addItemToPlaylist=r,f.removeItemFromPlaylist=d,f.isItemInPlayList=p}angular.module("ytApp").service("playlistService",t),t.$inject=["PlaylistResource","PlaylistItemsResource","PubSub"]}(),function(){"use strict";function t(t){var e=50,i="https://content.googleapis.com/youtube/v3/playlists";return t(i,null,{get:{method:"GET",params:{id:"@id"}},save:{method:"POST",params:{part:"snippet"}},query:{method:"GET",params:{part:"snippet",mine:"true",maxResults:e}},remove:{method:"DELETE"},"delete":{method:"DELETE"},update:{method:"PUT",params:{part:"snippet"}}})}angular.module("common.services").factory("PlaylistResource",["$resource",t])}(),function(){"use strict";function t(t){var e=50,i="https://www.googleapis.com/youtube/v3/playlistItems";return t(i,null,{get:{method:"GET",params:{id:"@id"}},save:{method:"POST",params:{part:"snippet"}},query:{method:"GET",params:{part:"snippet",playlistId:"@playlistId",mine:"true",maxResults:e}},remove:{method:"DELETE"},"delete":{method:"DELETE"}})}angular.module("common.services").factory("PlaylistItemsResource",["$resource",t])}(),function(){"use strict";function t(t){var e=50,i="https://www.googleapis.com/youtube/v3/search";return t(i,null,{query:{method:"GET",params:{part:"snippet",maxResults:e,q:"@q"}}})}angular.module("common.services").factory("SearchResource",["$resource",t])}(),function(){"use strict";function t(t){function e(e,i){var l=t.$on(e,function(t,e){i(e)});return l}function i(e,i){t.$emit(e,i)}return{subscribe:e,publish:i}}angular.module("ytApp").factory("PubSub",["$rootScope",t])}(),function(){"use strict";function t(t,e,i,l){function s(){""!==p.searchText&&i.go("home.search",{searchText:p.searchText})}function n(t){return 404===t.code&&_.any(t.errors,function(t){return"channelId"===t.location&&"channelNotFound"===t.reason})}function o(t){l.removeItemFromPlaylist(l.selectedPlaylist(),{id:t.id})}function a(t){l.selectPlaylist(t)}function c(t){l.selectPlaylistitem(t)}function r(){return i.current.name}function d(){p.isEditMode()?i.go(y&&"home.edit"!==y?y:"home.player"):(y=p.currentView(),i.go("home.edit"))}function u(){return"home.edit"===p.currentView()}var p=this;p.searchText="",p.playlistService=l,p.getSearchResult=s,p.removeFromPlaylist=o,p.setCurrentPlaylist=a,p.setCurrentPlaylistItem=c,p.currentView=r,p.toggleEdit=d,p.isEditMode=u,l.playlistsPromise.then(function(){p.playlistService.playlists.length?p.setCurrentPlaylist(l.playlists[0]):humane.log("For a start - add at least one playlist")},function(e){n(e.data.error)&&humane.log("You don't have a YouTube channel! Click here to create.",{timeout:0,clickToClose:!0,addnCls:"humane-flatty-error"},function(){t.open("https://www.youtube.com/create_channel")})});var y=null}angular.module("ytApp").controller("HomeController",["$window","$scope","$state","playlistService",t])}(),function(){"use strict";function t(t,e,i,l,s){function n(t){m.searchResult=o(t.items),l.selectedPlaylist()?c():l.playlists.length&&humane.log("Select a playlist first")}function o(t){var e=[];return t.forEach(function(t){"youtube#video"===t.id.kind&&e.push(t)}),e}function a(){m.searchResult&&_.any(m.searchResult,function(t){return!t.alreadyInList})&&c()}function c(){m.searchResult.forEach(function(t){t.alreadyInList=u(t)})}function r(t){return l.isItemInPlayList(l.selectedPlaylist(),t.id.videoId)}function d(t){l.selectedPlaylist()?r(t)||l.addItemToPlaylist(l.selectedPlaylist(),t.id.videoId):humane.log(l.playlists.length?"Select a playlist first":"For a start - add at least one playlist")}function u(t){return function(){return r(t)}}function p(t){return _.findIndex(l.selectedPlaylist().items,function(e){return e.snippet.resourceId.videoId===t.id.videoId})}function y(t){var e=p(t);-1!==e&&t.alreadyInList()&&l.removeItemFromPlaylist(l.selectedPlaylist(),l.selectedPlaylist().items[e])}var m=this;m.searchResult=[],m.playlistService=l,m.searchText=e.searchText,m.addToPlayList=d,m.removeFromPlayList=y,i.subscribe("playlist.selected",a);var v=function(){s.query({q:m.searchText},n)};l.playlistsPromise.then(function(){v()})}angular.module("ytApp").controller("SearchController",t),t.$inject=["$q","$stateParams","PubSub","playlistService","SearchResource"]}(),function(){"use strict";function t(t){var e=this;e.newPlaylist={snippet:{title:"",description:""},addMode:!1},e.playlistService=t,e.addNewPlaylistAccept=function(){t.addPlaylist(e.newPlaylist),e.toggleAddPlaylist()},e.addNewPlaylistReject=function(){e.toggleAddPlaylist()},e.removePlaylist=function(e){t.removePlaylist(e)},e.toggleAddPlaylist=function(){e.newPlaylist.addMode?e.newPlaylist.addMode=!1:(e.newPlaylist.snippet.title="",e.newPlaylist.snippet.description="",e.newPlaylist.addMode=!0)},e.togglePlaylistEdit=function(t){t.editMode?t.editMode=!1:(t.snippet.originTitle=t.snippet.title,t.snippet.originDescription=t.snippet.description,t.editMode=!0)},e.playlistChangesAccept=function(i){t.updatePlaylist(i).then(function(t){e.togglePlaylistEdit(i)},function(t){e.playlistChangesReject()})},e.playlistChangesReject=function(t){t.snippet.title=t.snippet.originTitle,t.snippet.description=t.snippet.originDescription,e.togglePlaylistEdit(t)}}angular.module("ytApp").controller("EditController",["playlistService",t])}(),function(){"use strict";function t(t){function e(){t.removeItemFromPlaylist(t.selectedPlaylist(),{id:t.selectedPlaylistitem().id})}function i(){var e=t.selectedPlaylistitem().snippet.resourceId.videoId;t.addItemToPlaylist(t.selectedPlaylist(),e).then(function(){t.selectPlaylistitem(t.selectedPlaylist().items[0])})}function l(){var e=t.selectedPlaylist(),i=t.selectedPlaylistitem();return e&&i?t.isItemInPlayList(e,i.snippet.resourceId.videoId):void 0}var s=this;s.playlistService=t,s.removeFromPlaylist=e,s.addToPlaylist=i,s.checkIsVideoInCurrentPlaylist=l}angular.module("ytApp").controller("PlayerController",["playlistService",t])}(),function(){"use strict";function t(t,e,i,l){var s=this;s.isLoggedIn=!1,s.userInfo={},s.isCollapsed=!0,i.checkAuth().then(function(){l.publish("loggedIn",!0),o()});var n=function(){i.isLoggedIn()?(l.publish("loggedIn",!0),e.go("home.player")):e.go("welcome")},o=function(){if(!s.userInfo.fullName){var t=i.getUser();s.userInfo.fullName=t.name,s.userInfo.picture=t.picture}};s.logIn=function(){i.login().then(o).then(n)},s.logOut=function(){i.logOut().error(function(t){l.publish("loggedIn",!1),e.go("welcome")}),l.publish("loggedIn",!0)},s.isActive=function(t){return e.current.name===t};var a=l.subscribe("loggedIn",function(t){s.isLoggedIn=t});t.$on("$destroy",function(){a()})}angular.module("ytApp").controller("AuthenticationController",["$scope","$state","authorizationService","PubSub",t])}(),function(){"use strict";function t(t,e){var i=this;i.isLoggedIn=e.isLoggedIn()}angular.module("ytApp").controller("WelcomeController",["$scope","authorizationService",t])}(),function(){"use strict";angular.module("directives",[])}(),function(){"use strict";function t(){var t=13;return{restrict:"A",link:function(e,i,l){i.bind("keydown",function(i){i instanceof KeyboardEvent&&i.keyCode===t&&e.$apply(l.enterPress)})}}}angular.module("directives").directive("enterPress",t)}(),angular.module("ytApp").run(["$templateCache",function(t){t.put("src/app/home/homeView.html",'<div class=jumbotron><div class=row><div class=col-md-9><div class=input-group ng-if=!vm.isEditMode()><input type=text ng-model=vm.searchText class=form-control enter-press=vm.getSearchResult() placeholder="Search for..."> <span class=input-group-btn><button class="btn btn-default" ng-click=vm.getSearchResult() type=button><span class="glyphicon glyphicon-search"></span></button></span></div></div><div class=col-md-3><div class=row><div class=col-md-9><div dropdown class=btn-group><button dropdown-toggle class="btn btn-default" type=button id=playlistDropdown aria-haspopup=true aria-expanded=true>{{vm.playlistService.selectedPlaylist().snippet.title}} <span class=caret></span></button><ul class=dropdown-menu role=menu aria-labelledby=playlistDropdown><li ng-repeat="playlist in vm.playlistService.playlists"><a ng-click=vm.setCurrentPlaylist(playlist)>{{playlist.snippet.title}}</a></li></ul></div><button class="btn btn-default pull-right visible-sm visible-xs" ng-click=vm.toggleEdit() title="Edit mode"><i class="glyphicon glyphicon-list"></i></button></div><div class="col-md-3 visible-md visible-lg"><button class="btn btn-default" ng-click=vm.toggleEdit() title="Edit mode"><i class="glyphicon glyphicon-list"></i></button></div></div></div></div><div class=row><div class=col-md-9><div ui-view></div></div><div class=col-md-3><div class="list-group playlist-control"><div ng-repeat="item in vm.playlistService.selectedPlaylist().items"><div class="list-group-item playlist-item"><span ng-click=vm.setCurrentPlaylistItem(item) class=clickable>{{item.snippet.title}}</span> <button type=button class="close-button pull-right top-right-corner" ng-if=vm.isEditMode() title="Remove playlist" ng-click=vm.removeFromPlaylist(item)><i class="glyphicon glyphicon-remove"></i></button></div></div></div></div></div></div>'),t.put("src/app/welcome/welcomeView.html","<div class=well><div class=welcome-text>Welcome to the Youtube API Application!</div><div ng-hide=vm.isLoggedIn>Please log in to continue...</div></div>"),t.put("src/app/home/edit/editView.html",'<div class><table class="table table-hover table-responsive"><tbody><tr><td></td><td><div ng-if=vm.newPlaylist.addMode><div><label>Title:</label> <input type=text class=full-width ng-minlength=1 ng-model=vm.newPlaylist.snippet.title></div><div><label>Description:</label> <input type=text class=full-width ng-model=vm.newPlaylist.snippet.description></div><br><div><button class="btn btn-warning pull-left" ng-click=vm.addNewPlaylistReject()><i class="glyphicon glyphicon-remove"></i></button> <button class="btn btn-success pull-right" ng-click=vm.addNewPlaylistAccept()><i class="glyphicon glyphicon-ok"></i></button></div></div></td><td><div><button type=button class=close-button title="Add new playlist" ng-click=vm.toggleAddPlaylist()><i class="glyphicon glyphicon-plus"></i></button></div></td></tr><tr ng-repeat="playlist in vm.playlistService.playlists"><td class=horizontal-center><img ng-src="{{playlist.snippet.thumbnails[\'default\'].url}}"></td><td><div class><label>Title:</label><div ng-if=playlist.editMode><input type=text class=full-width ng-minlength=1 ng-model=playlist.snippet.title></div><span ng-if=!playlist.editMode>{{playlist.snippet.title}}</span></div><div class=hidden-xs><label>Description:</label><div ng-if=playlist.editMode><input type=text class=full-width ng-model=playlist.snippet.description></div><span ng-if=!playlist.editMode>{{playlist.snippet.description || \'none\'}}</span></div><br><div ng-if=playlist.editMode><div class><button class="btn btn-warning pull-left" ng-click=vm.playlistChangesReject(playlist)><i class="glyphicon glyphicon-remove"></i></button> <button class="btn btn-success pull-right" ng-click=vm.playlistChangesAccept(playlist)><i class="glyphicon glyphicon-ok"></i></button></div></div></td><td><div><button type=button class=close-button title="Remove playlist" ng-click=vm.removePlaylist(playlist)><i class="glyphicon glyphicon-remove"></i></button></div><div><button type=button class=close-button title="Edit playlist" ng-click=vm.togglePlaylistEdit(playlist)><i class="glyphicon glyphicon-pencil"></i></button></div></td></tr></tbody></table></div>'),t.put("src/app/home/player/playerView.html",'<div class=player-container><div ng-if="vm.playlistService.selectedPlaylistitem() !== null"><div class=video-container><div><iframe ng-src={{vm.playlistService.selectedPlaylistitem().src}} frameborder=0 allowfullscreen></iframe></div></div><div class=player-info><div class=player-info-header><div class=player-video-title ng-if="vm.playlistService.selectedPlaylistitem() !== null">{{vm.playlistService.selectedPlaylistitem().snippet.title}}</div></div><div class=player-add-btn ng-hide="vm.playlistService.selectedPlaylistitem() === null || vm.checkIsVideoInCurrentPlaylist()"><button class="btn btn-primary" ng-click=vm.addToPlaylist()>Add to current playlist <span class="glyphicon glyphicon-plus" aria-hidden=true></span></button></div><div class=player-rmv-btn ng-show="vm.playlistService.selectedPlaylistitem() !== null && vm.checkIsVideoInCurrentPlaylist()"><button class="btn btn-danger" ng-click=vm.removeFromPlaylist()>Remove from current playlist <span class="glyphicon glyphicon-minus" aria-hidden=true></span></button></div></div></div><div ng-if="vm.playlistService.selectedPlaylistitem() === null" class=no-video-available>No video selected</div></div>'),t.put("src/app/home/search/searchView.html",'<div class><table class="table table-hover table-responsive"><tbody><tr ng-repeat="searchItem in vm.searchResult"><td class=horizontal-center><img class=yt-thumbnail ng-src="{{searchItem.snippet.thumbnails[\'default\'].url}}"></td><td><div class><label>Title:</label> <span>{{searchItem.snippet.title}}</span></div><div class=hidden-xs><label>Description:</label> <span>{{searchItem.snippet.description || \'none\'}}</span></div></td><td><div><button class="btn btn-success" ng-disabled=searchItem.alreadyInList() title="Add to current playlist" ng-click=vm.addToPlayList(searchItem)><i class="glyphicon glyphicon-plus"></i></button></div><div><button class="btn btn-error" ng-disabled=!searchItem.alreadyInList() title="Remove from current playlist" ng-click=vm.removeFromPlayList(searchItem)><i class="glyphicon glyphicon-remove"></i></button></div></td></tr></tbody></table></div>')}]);
